<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forge API Tool Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1><i class="fas fa-magic"></i> Forge API Tool</h1>
                <div class="status-indicators">
                    <div class="status-item" id="api-status">
                        <i class="fas fa-circle status-icon"></i>
                        <span class="status-text">API: Checking...</span>
                    </div>
                    <div class="status-item" id="generation-status">
                        <i class="fas fa-spinner fa-spin status-icon"></i>
                        <span class="status-text">Generation: Idle</span>
                    </div>
                    <div class="status-item" id="queue-status">
                        <i class="fas fa-list status-icon"></i>
                        <span class="status-text">Queue: 0 jobs</span>
                    </div>
                    <button class="btn btn-sm btn-secondary" onclick="openLiveStatusModal()" style="margin-left:1rem;">
                        <i class="fas fa-terminal"></i> Live Status
                    </button>
                    <button class="btn btn-sm btn-primary" id="api-connect-btn" onclick="toggleApiConnection()" style="margin-left:0.5rem;">
                        <i class="fas fa-plug"></i> Connect
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Left Sidebar - Templates -->
            <aside class="sidebar templates-sidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-layer-group"></i> Templates</h2>
                    <div class="sidebar-actions">
                        <button class="btn btn-sm btn-secondary" onclick="refreshTemplates()" title="Refresh Templates">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="btn btn-primary" onclick="showCreateTemplateModal()">
                            <i class="fas fa-plus"></i> New
                        </button>
                    </div>
                </div>
                
                <div class="templates-container">
                    <div class="templates-scroll">
                        {% if configs|length == 0 %}
                        <div class="text-center text-muted" style="margin-top:2rem; padding: 1rem;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <div>No templates found.</div>
                            <div style="font-size: 0.9rem; margin-top: 0.5rem;">Please add configurations in the configs/ directory.</div>
                            {% if error %}
                            <div style="font-size: 0.8rem; margin-top: 1rem; color: #dc3545; background: #f8d7da; padding: 0.5rem; border-radius: 4px;">
                                <strong>Error:</strong> {{ error }}
                            </div>
                            {% endif %}
                            <div style="font-size: 0.8rem; margin-top: 1rem; color: #6c757d;">
                                <strong>Debug Info:</strong><br>
                                Configs loaded: {{ configs|length }}<br>
                                {% if configs %}
                                Available: {{ configs.keys()|list|join(', ') }}
                                {% endif %}
                            </div>
                        </div>
                        {% else %}
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: #6c757d; padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                            <i class="fas fa-check-circle"></i> Found {{ configs|length }} template(s)
                            <div style="font-size: 0.8rem; margin-top: 0.25rem; color: #495057;">
                                <i class="fas fa-mouse-pointer"></i> Click any template card to load its prompt
                            </div>
                        </div>
                        {% endif %}
                        {% for config_name, config in configs.items() %}
                        <div class="template-card" data-config="{{ config_name }}">
                            <div class="template-header">
                                <h3 class="template-name">{{ config.get('name', config_name) }}</h3>
                                <div class="template-actions">
                                    <button class="btn-icon" onclick="editTemplate('{{ config_name }}')" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon" onclick="deleteTemplate('{{ config_name }}')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="template-info">
                                <div class="template-field">
                                    <span class="field-label">Description:</span>
                                    <span class="field-value">{{ config.get('description', 'No description') }}</span>
                                </div>
                                <div class="template-field">
                                    <span class="field-label">Model:</span>
                                    <span class="field-value">{{ config.get('model_type', 'Unknown').upper() }}</span>
                                </div>
                                <div class="template-field">
                                    <span class="field-label">Checkpoint:</span>
                                    <span class="field-value">{{ config.get('model_settings', {}).get('checkpoint', 'Unknown') }}</span>
                                </div>
                            </div>
                            <div class="template-actions-bar">
                                <button class="btn btn-sm btn-primary" onclick="generateSingle('{{ config_name }}')">
                                    <i class="fas fa-play"></i> Generate
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="startBatch('{{ config_name }}')">
                                    <i class="fas fa-layer-group"></i> Batch
                                </button>
                                <button class="btn btn-sm btn-info" onclick="openOutputFolder('{{ config_name }}')" title="Open Output Folder">
                                    <i class="fas fa-folder-open"></i> Folder
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <section class="main-content">
                <!-- Generation Progress -->
                <div class="progress-section" id="progress-section" style="display: none;">
                    <div class="progress-header">
                        <h3><i class="fas fa-cogs"></i> Generation Progress</h3>
                        <div class="progress-controls">
                            <span class="progress-config" id="progress-config"></span>
                            <button class="btn btn-sm btn-danger" onclick="stopGeneration()" id="stop-generation-btn">
                                <i class="fas fa-stop"></i> Stop Generation
                            </button>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progress-text">0 / 0 images</span>
                            <span id="progress-percentage">0%</span>
                        </div>
                    </div>
                    <div class="progress-details">
                        <span id="progress-time">Elapsed: 0s</span>
                        <span id="progress-eta">ETA: --</span>
                    </div>
                </div>

                <!-- Generation Controls -->
                <div class="generation-controls">
                    <div class="control-group">
                        <h3><i class="fas fa-magic"></i> Single Generation</h3>
                        <div class="input-group">
                            <label for="prompt-input">Prompt:</label>
                            <textarea id="prompt-input" placeholder="Enter your prompt here..."></textarea>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="seed-input">Seed:</label>
                                <input type="number" id="seed-input" placeholder="Random" min="-1" step="1" title="Enter a number for fixed seed, or leave empty for random">
                            </div>
                            <div class="input-group">
                                <label for="config-select">Template:</label>
                                <select id="config-select">
                                    <option value="">Select a template...</option>
                                    {% for config_name in configs.keys() %}
                                    <option value="{{ config_name }}">{{ config_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-large" onclick="generateImage()">
                            <i class="fas fa-play"></i> Generate Image
                        </button>
                    </div>

                    <div class="control-group">
                        <h3><i class="fas fa-layer-group"></i> Batch Generation</h3>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="batch-size">Batch Size:</label>
                                <input type="number" id="batch-size" value="4" min="1" max="10">
                            </div>
                            <div class="input-group">
                                <label for="num-batches">Number of Batches:</label>
                                <input type="number" id="num-batches" value="1" min="1" max="10">
                            </div>
                        </div>
                        <div class="batch-actions">
                            <button class="btn btn-secondary" onclick="previewBatch()">
                                <i class="fas fa-eye"></i> Preview
                            </button>
                            <button class="btn btn-primary" onclick="startBatchGeneration()">
                                <i class="fas fa-play"></i> Start Batch
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Image Analysis Section -->
                <div class="image-analysis-section">
                    <div class="section-header">
                        <h3><i class="fas fa-microscope"></i> Image Analysis & Config Creation</h3>
                        <div class="section-actions">
                            <button class="btn btn-sm btn-info" onclick="showAnalysisSummary()" title="Show Analysis Summary">
                                <i class="fas fa-list"></i> Summary
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="clearImageAnalysis()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <!-- Image Drop Zone -->
                    <div class="image-drop-zone" id="image-drop-zone">
                        <div class="drop-zone-content">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>Drop an image here to analyze</h4>
                            <p>or click to select a file</p>
                            <input type="file" id="image-file-input" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <!-- Analysis Results -->
                    <div class="analysis-results" id="analysis-results" style="display: none;">
                        <div class="analysis-header">
                            <h4><i class="fas fa-chart-line"></i> Analysis Results</h4>
                            <div class="analysis-actions">
                                <select id="analysis-selector" onchange="selectAnalysis(parseInt(this.value))" style="margin-right: 0.5rem; padding: 0.25rem; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="">No analyzed images</option>
                                </select>
                                <button class="btn btn-sm btn-danger" onclick="removeAnalysis(selectedAnalysisIndex)" title="Remove Current Analysis">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="createConfigFromAnalysis()">
                                    <i class="fas fa-save"></i> Create Config
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="editAnalysisConfig()">
                                    <i class="fas fa-edit"></i> Edit Settings
                                </button>
                            </div>
                        </div>
                        
                        <div class="analysis-content">
                            <div class="analysis-image">
                                <img id="analysis-image-preview" src="" alt="Analyzed Image">
                            </div>
                            
                            <div class="analysis-details">
                                <div class="detail-group">
                                    <h5>Image Information</h5>
                                    <div class="detail-item">
                                        <span class="detail-label">Dimensions:</span>
                                        <span class="detail-value" id="analysis-dimensions">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Format:</span>
                                        <span class="detail-value" id="analysis-format">-</span>
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <h5>Extracted Settings</h5>
                                    <div class="detail-item">
                                        <span class="detail-label">Prompt:</span>
                                        <span class="detail-value" id="analysis-prompt">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Negative Prompt:</span>
                                        <span class="detail-value" id="analysis-negative-prompt">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Steps:</span>
                                        <span class="detail-value" id="analysis-steps">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">CFG Scale:</span>
                                        <span class="detail-value" id="analysis-cfg-scale">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Sampler:</span>
                                        <span class="detail-value" id="analysis-sampler">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Seed:</span>
                                        <span class="detail-value" id="analysis-seed">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Denoising Strength:</span>
                                        <span class="detail-value" id="analysis-denoising-strength">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Clip Skip:</span>
                                        <span class="detail-value" id="analysis-clip-skip">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Restore Faces:</span>
                                        <span class="detail-value" id="analysis-restore-faces">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Tiling:</span>
                                        <span class="detail-value" id="analysis-tiling">-</span>
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <h5>Hires Fix Settings</h5>
                                    <div class="detail-item">
                                        <span class="detail-label">Hires Fix:</span>
                                        <span class="detail-value" id="analysis-hires-fix">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Hires Steps:</span>
                                        <span class="detail-value" id="analysis-hires-steps">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Hires Upscaler:</span>
                                        <span class="detail-value" id="analysis-hires-upscaler">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Hires Denoising:</span>
                                        <span class="detail-value" id="analysis-hires-denoising">-</span>
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <h5>Advanced Settings</h5>
                                    <div class="detail-item">
                                        <span class="detail-label">Subseed:</span>
                                        <span class="detail-value" id="analysis-subseed">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Subseed Strength:</span>
                                        <span class="detail-value" id="analysis-subseed-strength">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Text Encoder:</span>
                                        <span class="detail-value" id="analysis-text-encoder">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Model Hash:</span>
                                        <span class="detail-value" id="analysis-model-hash">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">VAE Hash:</span>
                                        <span class="detail-value" id="analysis-vae-hash">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">LoRA:</span>
                                        <span class="detail-value" id="analysis-lora">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Embedding:</span>
                                        <span class="detail-value" id="analysis-embedding">-</span>
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <h5>Model Information</h5>
                                    <div class="detail-item">
                                        <span class="detail-label">Model:</span>
                                        <span class="detail-value" id="analysis-model">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">VAE:</span>
                                        <span class="detail-value" id="analysis-vae">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outputs Section -->
                <div class="outputs-section">
                    <div class="section-header">
                        <h3><i class="fas fa-images"></i> Recent Outputs</h3>
                        <div class="section-actions">
                            <button class="btn btn-sm btn-info" onclick="openOutputFolder('')" title="Open Main Outputs Folder">
                                <i class="fas fa-folder-open"></i> Open Folder
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="refreshOutputs()">
                                <i class="fas fa-refresh"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="exportOutputs()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="outputs-grid" id="outputs-grid">
                        <!-- Outputs will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Right Sidebar - Queue & Logs -->
            <aside class="sidebar info-sidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-info-circle"></i> System Info</h2>
                </div>
                
                <!-- Queue Status -->
                <div class="info-card">
                    <h3><i class="fas fa-list"></i> Job Queue</h3>
                    <div class="queue-info">
                        <div class="queue-stat">
                            <span class="stat-label">Active Jobs:</span>
                            <span class="stat-value" id="queue-active">0</span>
                        </div>
                        <div class="queue-stat">
                            <span class="stat-label">Pending Jobs:</span>
                            <span class="stat-value" id="queue-pending">0</span>
                        </div>
                        <div class="queue-stat">
                            <span class="stat-label">Completed Jobs:</span>
                            <span class="stat-value" id="queue-completed">0</span>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="clearQueue()">
                        <i class="fas fa-trash"></i> Clear Queue
                    </button>
                </div>

                <!-- Output Statistics -->
                <div class="info-card">
                    <h3><i class="fas fa-chart-bar"></i> Output Stats</h3>
                    <div class="stats-info">
                        <div class="stat-item">
                            <span class="stat-label">Total Images:</span>
                            <span class="stat-value" id="total-images">{{ output_stats.get('total_outputs', 0) }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Today:</span>
                            <span class="stat-value" id="today-images">{{ output_stats.get('today_outputs', 0) }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Storage Used:</span>
                            <span class="stat-value" id="storage-used">{{ output_stats.get('storage_used', '0 MB') }}</span>
                        </div>
                    </div>
                </div>

                <!-- Logs Section -->
                <div class="info-card">
                    <h3><i class="fas fa-file-alt"></i> Logs</h3>
                    <div class="logs-actions">
                        <button class="btn btn-sm btn-secondary" onclick="viewLogs()">
                            <i class="fas fa-eye"></i> View Logs
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="clearLogs()">
                            <i class="fas fa-trash"></i> Clear Logs
                        </button>
                    </div>
                </div>

                <!-- RunDiffusion API Configuration -->
                <div class="info-card">
                    <h3><i class="fas fa-cloud"></i> RunDiffusion API</h3>
                    <div class="api-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="rundiffusion-toggle" onchange="toggleRunDiffusion()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Use RunDiffusion</span>
                    </div>
                    <div id="rundiffusion-config" style="display: none; margin-top: 1rem;">
                        <div class="input-group">
                            <label for="rundiffusion-url">Server URL:</label>
                            <input type="text" id="rundiffusion-url" placeholder="https://your-instance.rundiffusion.com" 
                                   value="https://your-instance.rundiffusion.com">
                        </div>
                        <div class="input-group">
                            <label for="rundiffusion-username">Username:</label>
                            <input type="text" id="rundiffusion-username" placeholder="rduser" value="rduser">
                        </div>
                        <div class="input-group">
                            <label for="rundiffusion-password">Password:</label>
                            <input type="password" id="rundiffusion-password" placeholder="rdpass" value="rdpass">
                        </div>
                        <div class="api-actions">
                            <button class="btn btn-sm btn-primary" onclick="testRunDiffusionConnection()">
                                <i class="fas fa-plug"></i> Test Connection
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="saveRunDiffusionConfig()">
                                <i class="fas fa-save"></i> Save Config
                            </button>
                        </div>
                        <div class="api-info" style="margin-top: 0.5rem; font-size: 0.8rem; color: #6c757d;">
                            <i class="fas fa-info-circle"></i> 
                            <strong>Quick Setup:</strong><br>
                            • Start your RunDiffusion instance<br>
                            • Enable API mode in settings<br>
                            • Use default credentials: rduser/rdpass<br>
                            • Or set custom credentials above
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Modals -->
    <div id="create-template-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Template</h3>
                <button class="close-btn" onclick="closeModal('create-template-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="template-name">Template Name:</label>
                    <input type="text" id="template-name" placeholder="Enter template name">
                </div>
                <div class="input-group">
                    <label for="template-config">Configuration (JSON):</label>
                    <textarea id="template-config" placeholder="Enter configuration JSON..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('create-template-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="createTemplate()">Create</button>
            </div>
        </div>
    </div>

    <div id="edit-template-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Template</h3>
                <button class="close-btn" onclick="closeModal('edit-template-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="edit-template-name">Template Name:</label>
                    <input type="text" id="edit-template-name" readonly>
                </div>
                <div class="input-group">
                    <label for="edit-template-config">Configuration (JSON):</label>
                    <textarea id="edit-template-config" placeholder="Enter configuration JSON..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('edit-template-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="updateTemplate()">Update</button>
            </div>
        </div>
    </div>

    <div id="batch-preview-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Batch Preview</h3>
                <button class="close-btn" onclick="closeModal('batch-preview-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="batch-preview-content">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('batch-preview-modal')">Close</button>
                <button class="btn btn-primary" onclick="confirmBatchGeneration()">Start Generation</button>
            </div>
        </div>
    </div>

    <div id="logs-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>System Logs</h3>
                <button class="close-btn" onclick="closeModal('logs-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="logs-content">
                    <!-- Logs will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('logs-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Live Status Modal -->
    <div id="live-status-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Live Status</h3>
                <button class="close-btn" onclick="closeModal('live-status-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="live-status-content" style="font-family:monospace; font-size:0.95rem; max-height:400px; overflow-y:auto;">
                    <!-- Live status events will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('live-status-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Config Editor Modal -->
    <div id="config-editor-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Config Editor</h3>
                <button class="close-btn" onclick="closeModal('config-editor-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-editor-tabs">
                    <button class="tab-btn active" onclick="switchConfigTab('basic')">Basic Settings</button>
                    <button class="tab-btn" onclick="switchConfigTab('prompt')">Prompt Settings</button>
                    <button class="tab-btn" onclick="switchConfigTab('generation')">Generation Settings</button>
                    <button class="tab-btn" onclick="switchConfigTab('model')">Model Settings</button>
                    <button class="tab-btn" onclick="switchConfigTab('output')">Output Settings</button>
                    <button class="tab-btn" onclick="switchConfigTab('json')">Raw JSON</button>
                </div>
                
                <div class="config-editor-content">
                    <!-- Basic Settings Tab -->
                    <div id="config-tab-basic" class="config-tab active">
                        <div class="input-group">
                            <label for="config-name">Config Name:</label>
                            <input type="text" id="config-name" placeholder="Enter config name">
                        </div>
                        <div class="input-group">
                            <label for="config-description">Description:</label>
                            <textarea id="config-description" placeholder="Enter description"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="config-model-type">Model Type:</label>
                            <select id="config-model-type">
                                <option value="sd">Stable Diffusion</option>
                                <option value="sdxl">SDXL</option>
                                <option value="sd15">SD 1.5</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Prompt Settings Tab -->
                    <div id="config-tab-prompt" class="config-tab">
                        <div class="input-group">
                            <label for="config-base-prompt">Base Prompt:</label>
                            <textarea id="config-base-prompt" placeholder="Enter base prompt"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="config-negative-prompt">Negative Prompt:</label>
                            <textarea id="config-negative-prompt" placeholder="Enter negative prompt"></textarea>
                        </div>
                    </div>
                    
                    <!-- Generation Settings Tab -->
                    <div id="config-tab-generation" class="config-tab">
                        <div class="input-row">
                            <div class="input-group">
                                <label for="config-steps">Steps:</label>
                                <input type="number" id="config-steps" min="1" max="100" value="20">
                            </div>
                            <div class="input-group">
                                <label for="config-cfg-scale">CFG Scale:</label>
                                <input type="number" id="config-cfg-scale" min="1" max="30" step="0.5" value="7.0">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="config-width">Width:</label>
                                <input type="number" id="config-width" min="64" max="2048" step="64" value="512">
                            </div>
                            <div class="input-group">
                                <label for="config-height">Height:</label>
                                <input type="number" id="config-height" min="64" max="2048" step="64" value="512">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="config-batch-size">Batch Size:</label>
                                <input type="number" id="config-batch-size" min="1" max="10" value="1">
                            </div>
                            <div class="input-group">
                                <label for="config-sampler">Sampler:</label>
                                <select id="config-sampler">
                                    <option value="Euler a">Euler a</option>
                                    <option value="Euler">Euler</option>
                                    <option value="LMS">LMS</option>
                                    <option value="Heun">Heun</option>
                                    <option value="DPM2">DPM2</option>
                                    <option value="DPM2 a">DPM2 a</option>
                                    <option value="DPM++ 2S a">DPM++ 2S a</option>
                                    <option value="DPM++ 2M">DPM++ 2M</option>
                                    <option value="DPM++ SDE">DPM++ SDE</option>
                                    <option value="DPM fast">DPM fast</option>
                                    <option value="DPM adaptive">DPM adaptive</option>
                                    <option value="LMS Karras">LMS Karras</option>
                                    <option value="DPM2 Karras">DPM2 Karras</option>
                                    <option value="DPM2 a Karras">DPM2 a Karras</option>
                                    <option value="DPM++ 2S a Karras">DPM++ 2S a Karras</option>
                                    <option value="DPM++ 2M Karras">DPM++ 2M Karras</option>
                                    <option value="DPM++ SDE Karras">DPM++ SDE Karras</option>
                                    <option value="DDIM">DDIM</option>
                                    <option value="PLMS">PLMS</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Model Settings Tab -->
                    <div id="config-tab-model" class="config-tab">
                        <div class="input-group">
                            <label for="config-checkpoint">Checkpoint:</label>
                            <input type="text" id="config-checkpoint" placeholder="Enter checkpoint name">
                        </div>
                        <div class="input-group">
                            <label for="config-vae">VAE:</label>
                            <input type="text" id="config-vae" placeholder="Enter VAE name">
                        </div>
                        <div class="input-group">
                            <label for="config-text-encoder">Text Encoder:</label>
                            <input type="text" id="config-text-encoder" placeholder="Enter text encoder">
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="config-gpu-weight">GPU Weight:</label>
                                <input type="number" id="config-gpu-weight" min="0" max="1" step="0.1" value="1.0">
                            </div>
                            <div class="input-group">
                                <label for="config-swap-method">Swap Method:</label>
                                <select id="config-swap-method">
                                    <option value="weight">Weight</option>
                                    <option value="cpu">CPU</option>
                                    <option value="offload">Offload</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="config-swap-location">Swap Location:</label>
                            <select id="config-swap-location">
                                <option value="cpu">CPU</option>
                                <option value="gpu">GPU</option>
                                <option value="disk">Disk</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Output Settings Tab -->
                    <div id="config-tab-output" class="config-tab">
                        <div class="input-group">
                            <label for="config-output-dir">Output Directory:</label>
                            <input type="text" id="config-output-dir" placeholder="outputs/{config_name}/{timestamp}/">
                        </div>
                        <div class="input-group">
                            <label for="config-output-format">Output Format:</label>
                            <select id="config-output-format">
                                <option value="png">PNG</option>
                                <option value="jpg">JPG</option>
                                <option value="webp">WebP</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="config-save-metadata" checked>
                                    Save Metadata
                                </label>
                            </div>
                            <div class="input-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="config-save-prompts" checked>
                                    Save Prompts
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Raw JSON Tab -->
                    <div id="config-tab-json" class="config-tab">
                        <div class="input-group">
                            <label for="config-json">Configuration JSON:</label>
                            <textarea id="config-json" placeholder="Enter configuration JSON..." style="height: 400px; font-family: monospace;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('config-editor-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveConfigFromEditor()">Save Config</button>
            </div>
        </div>
    </div>

    <!-- Create Config from Analysis Modal -->
    <div id="create-config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Config from Analysis</h3>
                <button class="close-btn" onclick="closeModal('create-config-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="new-config-name">Config Name:</label>
                    <input type="text" id="new-config-name" placeholder="Enter config name">
                </div>
                <div class="input-group">
                    <label for="new-config-description">Description:</label>
                    <textarea id="new-config-description" placeholder="Enter description"></textarea>
                </div>
                <div class="analysis-summary">
                    <h5>Analysis Summary:</h5>
                    <div id="create-config-summary">
                        <!-- Analysis summary will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('create-config-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmCreateConfig()">Create Config</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html> 